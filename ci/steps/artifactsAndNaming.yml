parameters:
  connectedServiceName: ''
  location: ''
  resourceGroupName: ''
  sourcesPipeline: ''
  sourcesProject: ''

steps:
- task: DownloadBuildArtifacts@0
  displayName: 'Download Sources'
  inputs:
    buildType: 'specific'
    project: '${{ parameters.sourcesProject }}'
    pipeline: '${{ parameters.sourcesPipeline }}'
    buildVersionToDownload: 'latest'
    downloadType: 'specific'
    itemPattern: '**'
    downloadPath: '$(System.ArtifactsDirectory)'

- task: AzureResourceGroupDeployment@2
  displayName: 'Deploy Naming'
  inputs:
    azureSubscription: '${{ parameters.connectedServiceName }}'
    resourceGroupName: '${{ parameters.resourceGroupName }}'
    location: '${{ parameters.location }}'
    csmFile: '$(System.ArtifactsDirectory)/Sources/Templates/azureDeployNaming.json'
    deploymentOutputs: 'azureDeployNaming'

- task: AzurePowerShell@4
  displayName: 'Get Naming Outputs'
  inputs:
    azureSubscription: '${{ parameters.connectedServiceName }}'
    ScriptType: 'FilePath'
    ScriptPath: '$(System.ArtifactsDirectory)/Sources/Scripts/Get-ARMOutputs.ps1'
    ScriptArguments: '-resourceGroupName ${{ parameters.resourceGroupName }}'
    azurePowerShellVersion: 'LatestVersion'

- task: AzurePowerShell@5
  displayName: 'Get Virtual Network'
  inputs:
    azureSubscription: '${{ parameters.connectedServiceName }}'
    ScriptType: 'FilePath'
    ScriptPath: '$(System.ArtifactsDirectory)/Sources/Scripts/Get-Vnet.ps1'
    ScriptArguments: '-resourceGroupName $(resourceGroupName) -virtualNetworkName $(virtualNetworkName)'
    azurePowerShellVersion: 'LatestVersion'